<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pyodide Plot Example</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
</head>
<body>
    <h1>Pyodide Plot Example</h1>
    <button onclick="generatePlot()">Generate Plot</button>
    <div id="plot"></div>

    <script type="text/javascript">
        
            let code = `
import matplotlib.pyplot as plt
import numpy as np

x = np.linspace(0, 10, 100)
y = np.sin(x)

fig, ax = plt.subplots()
ax.plot(x, y)

from js import document
import io
import base64

buf = io.BytesIO()
fig.savefig(buf, format='png')
buf.seek(0)
img_str = "data:image/png;base64," + base64.b64encode(buf.read()).decode('utf-8')
buf.close()

html_str = f'<img src="{img_str}" />'
document.getElementById('plot').innerHTML = html_str
`;
async function generatePlot() {
    loadPyodideAndPackages();
        }

        async function loadPyodideAndPackages() {
            let pyodide = await loadPyodide();
            await pyodide.loadPackage(['matplotlib', 'numpy']);
            await pyodide.runPythonAsync(code);
        }

        //loadPyodideAndPackages();
    </script>
</body>
</html>
